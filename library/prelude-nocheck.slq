// prelude file implicitly imported into all silq programs (with --nocheck, default for now)

def dup[Ï„:*]lifted(const x: Ï„)lifted: Ï„ â‡’ (quantumPrimitive("dup"):!(Î [Ï„:*]lifted. !(Î (x:Ï„)lifted. Ï„)))(x);
def measure[Ï„]lifted(x: Ï„):!Ï„ â‡’ (quantumPrimitive("M"):!(Î [Ï„:*]lifted. !(Î (x:Ï„). !Ï„)))(x);
def H(x: ğ”¹)mfree:ğ”¹ â‡’ (quantumPrimitive("H"):!(Î (x:ğ”¹)mfree. ğ”¹))(x);
def X(x: ğ”¹)qfree:ğ”¹ â‡’ (quantumPrimitive("X"):!(Î (x:ğ”¹)qfree. ğ”¹))(x);
def Y(x: ğ”¹)mfree:ğ”¹ â‡’ (quantumPrimitive("Y"):!(Î (x:ğ”¹)mfree. ğ”¹))(x);
def Z(x: ğ”¹)mfree:ğ”¹ â‡’ (quantumPrimitive("Z"):!(Î (x:ğ”¹)mfree. ğ”¹))(x);
def phase(Ï†: !â„)mfree:ğŸ™ â‡’ (quantumPrimitive("P"):!(Î (Ï†:!â„)mfree. ğŸ™))(Ï†);
def rotX(Ï†: !â„, x: ğ”¹)mfree:ğ”¹ â‡’ (quantumPrimitive("rX"):!(Î (Ï†: !â„, x: ğ”¹)mfree. ğ”¹))(Ï†,x);
def rotY(Ï†: !â„, x: ğ”¹)mfree:ğ”¹ â‡’ (quantumPrimitive("rY"):!(Î (Ï†: !â„, x: ğ”¹)mfree. ğ”¹))(Ï†,x);
def rotZ(Ï†: !â„, x: ğ”¹)mfree:ğ”¹ â‡’ (quantumPrimitive("rZ"):!(Î (Ï†: !â„, x: ğ”¹)mfree. ğ”¹))(Ï†,x);

def reverse[Ï„,Ï‡,Ï†]lifted(f: !(const Ï„ Ã— Ï‡ â†’mfree Ï†))lifted:const Ï„ Ã— Ï† â†’mfree Ï‡â‡’
  (quantumPrimitive("reverse"):!(Î [Ï„:*,Ï‡:*,Ï†:*]lifted. !(!(const Ï„Ã—Ï‡ â†’mfree Ï†) â†’lifted !(const Ï„ Ã— Ï† â†’mfree Ï‡))))(f);

dat int[n: !â„•] quantum{}
dat uint[n: !â„•] quantum{}
dat float[e: !â„•, m: !â„•] quantum{}
float32:=float[8,24];
float64:=float[11,53];
bool:=ğ”¹;
dat rat[n: !â„•, m: !â„•] quantum{}

// deterministic functions
def floor(x:!â„)lifted:!â„¤;
def ceil(x:!â„)lifted:!â„¤;
def round(x:!â„)lifted:!â„¤ â‡’ floor(x+1/2);
def inâ„¤(x:!â„)lifted:!ğ”¹ â‡’ x==floor(x);
def sqrt(x:!â„)lifted:!â„;
def exp(x:!â„)lifted:!â„;
def log(x:!â„)lifted:!â„;
def sin(x:!â„)lifted:!â„;
def asin(x:!â„)lifted:!â„;
def cos(x:!â„)lifted:!â„;
def acos(x:!â„)lifted:!â„;
def tan(x:!â„)lifted:!â„;
def atan(x:!â„)lifted:!â„;

// TODO: make the following functions generic
def abs(x:!â„)lifted:!â„ â‡’ if x<0 then -x else x;
def min[n:!â„•](x:!â„^n)lifted:!â„{
	r:=x[0];
	for i in [1..n){
		if x[i]<r{
			r=x[i];
		}
	}
	return r;
}
def max[n:!â„•](x:!â„^n)lifted:!â„{
	r:=x[0];
	for i in [1..n){
		if x[i]>r{
			r=x[i];
		}
	}
	return r;
}

def array[Ï„:*](n: !â„•,const x:Ï„)lifted:Ï„[]â‡’(quantumPrimitive("array"):!(Î [Ï„:*]lifted. !â„•Ã—const Ï„â†’lifted Ï„[]))(n,x);
def vector[Ï„:*](n:!â„•,const x:Ï„)lifted:Ï„^nâ‡’(quantumPrimitive("vector"):!(Î [Ï„:*]lifted. Î (n:!â„•,const x:Ï„)lifted. Ï„^n))(n,x);

def print[Ï„:*](x:!Ï„)lifted{
	def printImpl(x:!Ï„)lifted:ğŸ™;
	printImpl(x);
}
def dump()lifted:ğŸ™;
def exit()lifted:ğŸ™;

/+
// first-class inference
dat Distribution[a]{ } // TODO: dat Distribution[a];
def infer[a](f:ğŸ™â†’ a):Distribution[a] â‡’ sampleFrom("(r;f)=>Î´(Î›x.f()[x]/âˆ«dy f()[y])[r]",f):Distribution[a];
def errorPr[a](d:Distribution[a]):â„ â‡’ 0;
def sample[a](d:Distribution[a]):a â‡’ sampleFrom("(x;d)=>d[x]",d):a;
def expectation(d:Distribution[â„]):â„ â‡’ (sampleFrom("(r;d)=>Î´(0)[-r+âˆ«dx d[x]Â·x]",d):â„);

// distributions
def gauss(Î¼:â„,Î½:â„):â„ â‡’ sampleFrom("(x;Î¼,Î½)=>[Î½=0]Â·Î´(0)[-Î¼+x]+[Î½â‰ 0]Â·e^((-1/2Â·xÂ²+-1/2Â·Î¼Â²+xÂ·Î¼)Â·â…ŸÎ½)Â·â…Ÿâˆš2Ì…Â·â…ŸâˆšÎ½Ì…Â·â…ŸâˆšÏ€Ì…",Î¼,Î½);
def Gauss(Î¼:â„,Î½:â„):Distribution[â„] â‡’ infer(()=>(sampleFrom("(x;Î¼,Î½)=>[Î½=0]Â·Î´(0)[-Î¼+x]+[Î½â‰ 0]Â·e^((-1/2Â·xÂ²+-1/2Â·Î¼Â²+xÂ·Î¼)Â·â…ŸÎ½)Â·â…Ÿâˆš2Ì…Â·â…ŸâˆšÎ½Ì…Â·â…ŸâˆšÏ€Ì…",Î¼,Î½):â„));

def chiSquared(k:â„):â„ â‡’ sampleFrom("(x;k)=>[-xâ‰¤0]Â·[kâ‰ 0]Â·x^(-1+1/2Â·k)Â·â…Ÿ(âˆ«dÎ¾â‚[-Î¾â‚â‰¤0]Â·Î¾â‚^(-1+1/2Â·k)Â·â…Ÿe^Î¾â‚)Â·â…Ÿ2^(1/2Â·k)Â·â…Ÿe^(1/2Â·x)+[k=0]Â·Î´(0)[x]",k):â„;
def ChiSquared(k:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;k)=>[-xâ‰¤0]Â·[kâ‰ 0]Â·x^(-1+1/2Â·k)Â·â…Ÿ(âˆ«dÎ¾â‚[-Î¾â‚â‰¤0]Â·Î¾â‚^(-1+1/2Â·k)Â·â…Ÿe^Î¾â‚)Â·â…Ÿ2^(1/2Â·k)Â·â…Ÿe^(1/2Â·x)+[k=0]Â·Î´(0)[x]",k):â„);

def rayleigh(Î½:â„):â„ â‡’ sampleFrom("(x;Î½)=>[-xâ‰¤0]Â·[Î½â‰ 0]Â·xÂ·â…Ÿe^(1/2Â·xÂ²Â·â…ŸÎ½)Â·â…ŸÎ½+[Î½=0]Â·Î´(0)[x]",Î½):â„;
def Rayleigh(Î½:â„):Distribution[â„] â‡’	infer(() â‡’ sampleFrom("(x;Î½)=>[-xâ‰¤0]Â·[Î½â‰ 0]Â·xÂ·â…Ÿe^(1/2Â·xÂ²Â·â…ŸÎ½)Â·â…ŸÎ½+[Î½=0]Â·Î´(0)[x]",Î½):â„);

def truncatedGauss(Î¼:â„,Î½:â„,a:â„,b:â„):â„ â‡’ sampleFrom("(x;Î¼,Î½,a,b)=>[-b+xâ‰¤0]Â·[-x+aâ‰¤0]Â·[Î½â‰ 0]Â·e^((-1/2Â·xÂ²+-1/2Â·Î¼Â²+xÂ·Î¼)Â·â…ŸÎ½)Â·â…Ÿ((d/dx)â»Â¹[e^(-xÂ²)]((-Î¼+b)Â·â…ŸâˆšÎ½Ì…)+-(d/dx)â»Â¹[e^(-xÂ²)]((-Î¼+a)Â·â…ŸâˆšÎ½Ì…))Â·â…ŸÎ½Â·â…Ÿâˆš2Ì…Â·â…ŸâˆšÏ€Ì…+[Î½=0]Â·Î´(0)[-Î¼+x]",Î¼,Î½,a,b):â„;
def TruncatedGauss(Î¼:â„,Î½:â„,a:â„,b:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;Î¼,Î½,a,b)=>[-b+xâ‰¤0]Â·[-x+aâ‰¤0]Â·[Î½â‰ 0]Â·e^((-1/2Â·xÂ²+-1/2Â·Î¼Â²+xÂ·Î¼)Â·â…ŸÎ½)Â·â…Ÿ((d/dx)â»Â¹[e^(-xÂ²)]((-Î¼+b)Â·â…ŸâˆšÎ½Ì…)+-(d/dx)â»Â¹[e^(-xÂ²)]((-Î¼+a)Â·â…ŸâˆšÎ½Ì…))Â·â…ŸÎ½Â·â…Ÿâˆš2Ì…Â·â…ŸâˆšÏ€Ì…+[Î½=0]Â·Î´(0)[-Î¼+x]",Î¼,Î½,a,b):â„);

def pareto(a:â„,b:â„):â„ â‡’ sampleFrom("(x;a,b)=>[-x+bâ‰¤0]Â·[-xâ‰¤0]Â·aÂ·b^aÂ·x^(-1+-a)",a,b):â„;
def Pareto(a:â„,b:â„):Distribution[â„] â‡’ infer(()=>sampleFrom("(x;a,b)=>[-x+bâ‰¤0]Â·[-xâ‰¤0]Â·aÂ·b^aÂ·x^(-1+-a)",a,b):â„);

def uniform(a:â„,b:â„):â„ â‡’ sampleFrom("(x;a,b)=>[aâ‰ b]Â·[aâ‰¤x]Â·[xâ‰¤b]Â·â…Ÿ(b-a)+[a=b]Â·Î´(0)[a-x]",a,b):â„;
def Uniform(a:â„,b:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;a,b)=>[aâ‰ b]Â·[aâ‰¤x]Â·[xâ‰¤b]Â·â…Ÿ(b-a)+[a=b]Â·Î´(0)[a-x]",a,b):â„);

/+def cosUniform() â‡’ sampleFrom("(r)=>[-1+-râ‰ 0]Â·[-1+-râ‰¤0]Â·[-1+râ‰¤0]Â·[-r+1â‰ 0]Â·â…ŸÏ€Â·â…Ÿâˆš-Ì…rÌ…Â²Ì…+Ì…1Ì…");
def CosUniform() â‡’ infer(() â‡’ sampleFrom("(r)=>[-1+-râ‰ 0]Â·[-1+-râ‰¤0]Â·[-1+râ‰¤0]Â·[-r+1â‰ 0]Â·â…ŸÏ€Â·â…Ÿâˆš-Ì…rÌ…Â²Ì…+Ì…1Ì…"));+/

def flip(p:â„):â„ â‡’ sampleFrom("(x;p)=>(1-p)Â·Î´(0)[x]+pÂ·Î´(0)[1-x]",p):â„;
def Flip(p:â„):Distribution[â„] â‡’ infer(()=>sampleFrom("(x;p)=>(1-p)Â·Î´(0)[x]+pÂ·Î´(0)[1-x]",p):â„);
def bernoulli(p:â„) â‡’ flip(p);
def Bernoulli(p:â„) â‡’ Flip(p);

def uniformInt(a:â„,b:â„):â„ â‡’ sampleFrom("(x;a,b)=>(âˆ‘_i[aâ‰¤i]Â·[iâ‰¤b]Â·Î´(0)[i-x])Â·â…Ÿ(âˆ‘_i[aâ‰¤i]Â·[iâ‰¤b])",a,b):â„;
def UniformInt(a:â„,b:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;a,b)=>(âˆ‘_i[aâ‰¤i]Â·[iâ‰¤b]Â·Î´(0)[i-x])Â·â…Ÿ(âˆ‘_i[aâ‰¤i]Â·[iâ‰¤b])",a,b):â„);

def binomial(n:â„,p:â„):â„ â‡’ sampleFrom("(x;n,p)=>âˆ‘_Î¾â‚(-p+1)^(-Î¾â‚+n)Â·(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^nÂ·â…Ÿe^Î¾â‚‚)Â·[-n+Î¾â‚â‰¤0]Â·[-Î¾â‚â‰¤0]Â·p^Î¾â‚Â·Î´(0)[-Î¾â‚+x]Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^(-Î¾â‚+n)Â·â…Ÿe^Î¾â‚‚)Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^Î¾â‚Â·â…Ÿe^Î¾â‚‚)",n,p):â„;
def Binomial(n:â„,p:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;n,p)=>âˆ‘_Î¾â‚(-p+1)^(-Î¾â‚+n)Â·(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^nÂ·â…Ÿe^Î¾â‚‚)Â·[-n+Î¾â‚â‰¤0]Â·[-Î¾â‚â‰¤0]Â·p^Î¾â‚Â·Î´(0)[-Î¾â‚+x]Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^(-Î¾â‚+n)Â·â…Ÿe^Î¾â‚‚)Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^Î¾â‚Â·â…Ÿe^Î¾â‚‚)",n,p):â„);

def negBinomial(r:â„,p:â„):â„ â‡’ sampleFrom("(x;r,p)=>âˆ‘_Î¾â‚(-p+1)^Î¾â‚Â·(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^(-1+r+Î¾â‚)Â·â…Ÿe^Î¾â‚‚)Â·[-Î¾â‚â‰¤0]Â·p^rÂ·Î´(0)[-Î¾â‚+x]Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^(-1+r)Â·â…Ÿe^Î¾â‚‚)Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^Î¾â‚Â·â…Ÿe^Î¾â‚‚)",r,p):â„;
def NegBinomial(r:â„,p:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;r,p)=>âˆ‘_Î¾â‚(-p+1)^Î¾â‚Â·(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^(-1+r+Î¾â‚)Â·â…Ÿe^Î¾â‚‚)Â·[-Î¾â‚â‰¤0]Â·p^rÂ·Î´(0)[-Î¾â‚+x]Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^(-1+r)Â·â…Ÿe^Î¾â‚‚)Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^Î¾â‚Â·â…Ÿe^Î¾â‚‚)",r,p):â„);

def geometric(p:â„):â„ â‡’ sampleFrom("(x;p)=>âˆ‘_i[0â‰¤i]Â·(1-p)^iÂ·pÂ·Î´(0)[i-x]",p);
def Geometric(p:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;p)=>âˆ‘_i[0â‰¤i]Â·(1-p)^iÂ·pÂ·Î´(0)[i-x]",p));

def poisson(Î»:â„):â„ â‡’ sampleFrom("(x;l)=>(âˆ‘_Î¾â‚[-Î¾â‚â‰¤0]Â·Î´(0)[-Î¾â‚+x]Â·l^Î¾â‚Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^Î¾â‚Â·â…Ÿe^Î¾â‚‚))Â·â…Ÿe^l",Î»);
def Poisson(Î»:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;l)=>(âˆ‘_Î¾â‚[-Î¾â‚â‰¤0]Â·Î´(0)[-Î¾â‚+x]Â·l^Î¾â‚Â·â…Ÿ(âˆ«dÎ¾â‚‚[-Î¾â‚‚â‰¤0]Â·Î¾â‚‚^Î¾â‚Â·â…Ÿe^Î¾â‚‚))Â·â…Ÿe^l",Î»));

def beta(Î±:â„,Î²:â„):â„ â‡’ sampleFrom("(x;Î±,Î²)=>((-x+1)^(-1+Î²)Â·[-1+xâ‰¤0]Â·[-xâ‰¤0]Â·[Î±â‰ 0]Â·[Î²â‰ 0]Â·x^(-1+Î±)+[Î±=0]Â·Î´(0)[x]+[Î²=0]Â·Î´(0)[-x+1])Â·(1/2Â·[Î±=0]Â·[Î²=0]+[Î±=0]Â·[Î²â‰ 0]+[Î±â‰ 0]Â·[Î²=0]+[Î±â‰ 0]Â·[Î²â‰ 0]Â·â…Ÿ(âˆ«dÎ¾â‚(-Î¾â‚+1)^(-1+Î²)Â·[-1+Î¾â‚â‰¤0]Â·[-Î¾â‚â‰¤0]Â·Î¾â‚^(-1+Î±)))",Î±,Î²):â„;
def Beta(Î±:â„,Î²:â„):Distribution[â„] â‡’ infer(()=>sampleFrom("(x;Î±,Î²)=>((-x+1)^(-1+Î²)Â·[-1+xâ‰¤0]Â·[-xâ‰¤0]Â·[Î±â‰ 0]Â·[Î²â‰ 0]Â·x^(-1+Î±)+[Î±=0]Â·Î´(0)[x]+[Î²=0]Â·Î´(0)[-x+1])Â·(1/2Â·[Î±=0]Â·[Î²=0]+[Î±=0]Â·[Î²â‰ 0]+[Î±â‰ 0]Â·[Î²=0]+[Î±â‰ 0]Â·[Î²â‰ 0]Â·â…Ÿ(âˆ«dÎ¾â‚(-Î¾â‚+1)^(-1+Î²)Â·[-1+Î¾â‚â‰¤0]Â·[-Î¾â‚â‰¤0]Â·Î¾â‚^(-1+Î±)))",Î±,Î²):â„);

def gamma(Î±:â„,Î²:â„):â„ â‡’ sampleFrom("(x;Î±,Î²)=>([-xâ‰¤0]Â·[Î±â‰ 0]Â·x^(-1+Î±)Â·â…Ÿe^(xÂ·Î²)+[Î±=0]Â·Î´(0)[x])Â·([Î±=0]+[Î±â‰ 0]Â·â…Ÿ(âˆ«dÎ¾â‚[-Î¾â‚â‰¤0]Â·Î¾â‚^(-1+Î±)Â·â…Ÿe^(Î²Â·Î¾â‚)))",Î±,Î²):â„;
def Gamma(Î±:â„,Î²:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;Î±,Î²)=>([-xâ‰¤0]Â·[Î±â‰ 0]Â·x^(-1+Î±)Â·â…Ÿe^(xÂ·Î²)+[Î±=0]Â·Î´(0)[x])Â·([Î±=0]+[Î±â‰ 0]Â·â…Ÿ(âˆ«dÎ¾â‚[-Î¾â‚â‰¤0]Â·Î¾â‚^(-1+Î±)Â·â…Ÿe^(Î²Â·Î¾â‚)))",Î±,Î²):â„);

def laplace(Î¼:â„,b:â„):â„ â‡’ sampleFrom("(x;Î¼,b)=>(1/2Â·[-x+Î¼â‰¤0]Â·e^((-x+Î¼)Â·â…Ÿb)+1/2Â·[-Î¼+xâ‰ 0]Â·[-Î¼+xâ‰¤0]Â·e^((-Î¼+x)Â·â…Ÿb))Â·[bâ‰ 0]Â·â…Ÿb+[b=0]Â·Î´(0)[-Î¼+x]",Î¼,b):â„;
def Laplace(Î¼:â„,b:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;Î¼,b)=>(1/2Â·[-x+Î¼â‰¤0]Â·e^((-x+Î¼)Â·â…Ÿb)+1/2Â·[-Î¼+xâ‰ 0]Â·[-Î¼+xâ‰¤0]Â·e^((-Î¼+x)Â·â…Ÿb))Â·[bâ‰ 0]Â·â…Ÿb+[b=0]Â·Î´(0)[-Î¼+x]",Î¼,b):â„);

def cauchy(xâ‚€:â„,Î³:â„):â„ â‡’ sampleFrom("(x;xâ‚€,Î³)=>[Î³=0]Â·Î´(0)[-xâ‚€+x]+[Î³â‰ 0]Â·â…Ÿ((-2Â·xÂ·xâ‚€Â·Ï€+xâ‚€Â²Â·Ï€+xÂ²Â·Ï€)Â·â…ŸÎ³Â²+Ï€)Â·â…ŸÎ³",xâ‚€,Î³):â„;
def Cauchy(xâ‚€:â„,Î³:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;xâ‚€,Î³)=>[Î³=0]Â·Î´(0)[-xâ‚€+x]+[Î³â‰ 0]Â·â…Ÿ((-2Â·xÂ·xâ‚€Â·Ï€+xâ‚€Â²Â·Ï€+xÂ²Â·Ï€)Â·â…ŸÎ³Â²+Ï€)Â·â…ŸÎ³",xâ‚€,Î³):â„);

def exponential(Î»:â„):â„ â‡’ sampleFrom("(x;l)=>[0â‰¤x]Â·lÂ·e^(-xÂ·l)",Î»):â„;
def Exponential(Î»:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;l)=>[0â‰¤x]Â·lÂ·e^(-xÂ·l)",Î»):â„);

def studentT(Î½:â„):â„ â‡’ sampleFrom("(x;Î½)=>[Î½â‰ 0]Â·(1+xÂ²Â·â…ŸÎ½)^(-1/2+-1/2Â·Î½)Â·â…Ÿ(âˆ«dÎ¾â‚(1+Î¾â‚Â²Â·â…ŸÎ½)^(-1/2+-1/2Â·Î½))+[Î½=0]Â·Î´(0)[x]",Î½):â„;
def StudentT(Î½:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;Î½)=>[Î½â‰ 0]Â·(1+xÂ²Â·â…ŸÎ½)^(-1/2+-1/2Â·Î½)Â·â…Ÿ(âˆ«dÎ¾â‚(1+Î¾â‚Â²Â·â…ŸÎ½)^(-1/2+-1/2Â·Î½))+[Î½=0]Â·Î´(0)[x]",Î½):â„);

def weibull(Î»:â„,k:â„):â„ â‡’ sampleFrom("(x;l,k)=>([k=0]Â·[lâ‰ 0]+[l=0])Â·Î´(0)[x]+[-xâ‰¤0]Â·[kâ‰ 0]Â·[lâ‰ 0]Â·kÂ·x^(-1+k)Â·â…Ÿe^(x^kÂ·â…Ÿl^k)Â·â…Ÿl^k",Î»,k):â„;
def Weibull(Î»:â„,k:â„):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;l,k)=>([k=0]Â·[lâ‰ 0]+[l=0])Â·Î´(0)[x]+[-xâ‰¤0]Â·[kâ‰ 0]Â·[lâ‰ 0]Â·kÂ·x^(-1+k)Â·â…Ÿe^(x^kÂ·â…Ÿl^k)Â·â…Ÿl^k",Î»,k):â„);

def categorical(p:â„[]):â„ â‡’ sampleFrom("(x;p)=>âˆ‘_i[0â‰¤i]Â·[i<p.length]Â·p@[i]Â·Î´(0)[i-x]",p):â„;
def Categorical(p:â„[]):Distribution[â„] â‡’ infer(() â‡’ sampleFrom("(x;p)=>âˆ‘_i[0â‰¤i]Â·[i<p.length]Â·p@[i]Â·Î´(0)[i-x]",p):â„);

def dirac[a](x:a) â‡’ x;
def Dirac[a](x:a) â‡’ infer(()=>x);

def dirichlet(Î±: â„[]){
	r:=array(Î±.length,0.0);
	sum:=0.0;
	for i in [0..Î±.length){
		r[i]=gamma(Î±[i],1.0);
		sum+=r[i];
	}
	for i in [0..Î±.length){
		r[i]/=sum;
	}
	return r;
}
def Dirichlet(Î±: â„[]) â‡’ infer(()=>dirichlet(Î±));

def multiGauss(Î¼: â„[], Î£: â„[][]){
	def mmv(A: â„[][], b: â„[]){
		r:=array(A.length,0.0);
		for i in [0..A.length){
			for j in [0..b.length){
				r[i]+=A[i][j]*b[j];
			}
		}
		return r;
	}
	def avv(a: â„[], b: â„[]){
		r:=array(a.length,0.0);
		for i in [0..a.length){
			r[i]=a[i]+b[i];
		}
		return r;
	}
	def dot(a: â„[], b: â„[]){
		r:=0.0;
		for i in [0..a.length){
			r+=a[i]*b[i];
		}
		return r;
	}
	def cholesky(A: â„[][]){
		L := array(A.length,array(A.length,0.0));
		for i in [0..A.length){
			for j in [0..i]{
				t := dot(L[i][0..j],L[j][0..j]);
				if i == j {
					L[i][j] = (A[i][j]-t)^(1/2)
				}else if L[j][j]!=0{
					L[i][j] = (A[i][j]-t)/L[j][j];
				}
			}
		}
		return L;
	}
	r := array(Î¼.length,0.0);
	for i in [0..r.length){
		r[i] = gauss(0,1);
	}
	return avv(mmv(cholesky(Î£),r),Î¼);
}
def MultiGauss(Î¼: â„[], Î£: â„[][])â‡’infer(()â‡’ multiGauss(Î¼,Î£));
+/
__NOCHECK__ := 1;

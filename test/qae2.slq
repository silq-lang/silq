// skipped

import qpe;

def makeQ[a:type,g:type](const makeGood: g â†’mfree a, const makeA: ğŸ™â†’mfree a)(u:a){
	on v:=makeGood(u) { phase(Ï€); } // TODO (or: where v := ... { ... })
	on ():=makeA(u) { phase(Ï€); }   // TODO
	phase(Ï€);
	return u;
}

def estimateAmplitude[m:!â„•][a:qtype](const Q: a â†’mfree a, u: a){
	Qp := [p:uint[m]](u:a){
		p:=dup(p); // TODO: fix and remove
		for i in 0..m{
			if p[i]{
				for k in 0..2^i{
					u:=Q(u);
				}
			}
		}
		return u;
	};
	return sin(Ï€Â·(estimatePhase[m](Qp,u) as !â„¤)/2^m)^2;
}

def makeBernoulliQ[p:!â„](x:ğ”¹)â‡’rotY(2Â·asin(sqrt(p)),x);

def main(){
	makeA:=()â‡’makeBernoulliQ[0.2](0);
	makeGood:=()â‡’1;
	Q:=makeQ(makeGood,makeA);
	return estimateAmplitude[8](Q,A(0));
}

